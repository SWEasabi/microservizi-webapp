<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Sweasabi Project - Webapp Documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">Sweasabi Project - Webapp Documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  Store</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/services/app.service.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Interface representing the application state store.
It contains arrays of lamps, sensors, and areas,
as well as loading and error flags.</p>

            </p>


        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#areas" 
>
                                            areas
                                        </a>
                                </li>
                                <li>
                                        <a href="#error" 
>
                                            error
                                        </a>
                                </li>
                                <li>
                                        <a href="#firstLoad" 
>
                                            firstLoad
                                        </a>
                                </li>
                                <li>
                                        <a href="#lamps" 
>
                                            lamps
                                        </a>
                                </li>
                                <li>
                                        <a href="#loading" 
>
                                            loading
                                        </a>
                                </li>
                                <li>
                                        <a href="#sensors" 
>
                                            sensors
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="areas"></a>
                                        <span class="name "><b>areas</b>
                                            <a href="#areas">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>areas:         <code><a href="../interfaces/AreaStatus.html" target="_self" >AreaStatus[]</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../interfaces/AreaStatus.html" target="_self" >AreaStatus[]</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>An array of area statuses representing the state of areas in the application.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="error"></a>
                                        <span class="name "><b>error</b>
                                            <a href="#error">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>error:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>A string representing an error message in case of any errors.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="firstLoad"></a>
                                        <span class="name "><b>firstLoad</b>
                                            <a href="#firstLoad">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>firstLoad:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>A flag indicating whether it is the first load of data.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="lamps"></a>
                                        <span class="name "><b>lamps</b>
                                            <a href="#lamps">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>lamps:         <code><a href="../interfaces/LampStatus.html" target="_self" >LampStatus[]</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../interfaces/LampStatus.html" target="_self" >LampStatus[]</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>An array of lamp statuses representing the state of lamps in the application.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="loading"></a>
                                        <span class="name "><b>loading</b>
                                            <a href="#loading">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>loading:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>A flag indicating whether data is currently being loaded or fetched.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="sensors"></a>
                                        <span class="name "><b>sensors</b>
                                            <a href="#sensors">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>sensors:         <code><a href="../interfaces/SensorStatus.html" target="_self" >SensorStatus[]</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../interfaces/SensorStatus.html" target="_self" >SensorStatus[]</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>An array of sensor statuses representing the state of sensors in the application.</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { HttpStatusCode } from &quot;@angular/common/http&quot;;
import { inject, Injectable } from &quot;@angular/core&quot;;
import { BehaviorSubject, catchError, delay, map, Observable, of, switchMap, tap } from &quot;rxjs&quot;;
import { LampStatus, SensorStatus, AreaStatus } from &quot;../model&quot;;
import { ApiService } from &quot;./api.service&quot;;

/**
 * Interface representing the application state store.
 * It contains arrays of lamps, sensors, and areas,
 * as well as loading and error flags.
 */
interface Store {
  /**
   * An array of lamp statuses representing the state of lamps in the application.
   */
  lamps: LampStatus[];
  /**
   * An array of sensor statuses representing the state of sensors in the application.
   */
  sensors: SensorStatus[];
  /**
   * An array of area statuses representing the state of areas in the application.
   */
  areas: AreaStatus[];
  /**
   * A flag indicating whether data is currently being loaded or fetched.
   */
  loading: boolean;
  /**
   * A flag indicating whether it is the first load of data.
   */
  firstLoad: boolean;
  /**
   * A string representing an error message in case of any errors.
   */
  error: string;
}


/**
 * Initial state for the application store.
 * Contains empty arrays for lamps, sensors, and areas,
 * and sets the loading and firstLoad flags to false.
 */
const initialState: Store &#x3D; {
  lamps: [],
  sensors: [],
  areas: [],
  loading: false,
  firstLoad: true,
  error: null
};

/**
 * The main service for managing application state.
 * Handles operations related to lamps, sensors, and areas, including
 * loading data from the API, managing errors, and updating state.
 */
@Injectable({
  providedIn: &quot;root&quot;
})

export class AppService {

  /**
   * Inject the ApiService.
   */
  api &#x3D; inject(ApiService);

  /**
   * Define the application&#x27;s main state store as a BehaviorSubject.
   * This is an RxJS Subject that can emit new values to its subscribers
   * and has the characteristic that it will always return the last value emitted to new subscribers.
   * Here it&#x27;s initialized with an initial state.
   */

  $store &#x3D; new BehaviorSubject&lt;Store&gt;(initialState);
  /**
     * Define selectors for different pieces of state.
     */
  readonly lamps$ &#x3D; this.$store.pipe(map(state &#x3D;&gt; state.lamps));
  readonly sensors$ &#x3D; this.$store.pipe(map(state &#x3D;&gt; state.sensors));
  readonly areas$ &#x3D; this.$store.pipe(map(state &#x3D;&gt; state.areas));
  readonly error$ &#x3D; this.$store.pipe(map(state &#x3D;&gt; state.error));
  readonly loading$ &#x3D; this.$store.pipe(map(state &#x3D;&gt; state.loading), delay(0));
  readonly firstLoad$ &#x3D; this.$store.pipe(map(state &#x3D;&gt; state.firstLoad));

  /**
   * Load lamp data from the API.
   * Update the state with the new data, manage any errors,
   * and stop the loading spinner when complete.
   */
  public loadData() {
    this.startLoading();
    this.api.getAllLamps$()
      .subscribe({
        next: (lamps) &#x3D;&gt; {
          this.$store.next({
            ...this.$store.value,
            lamps,
            firstLoad: false
          });
        },
        error: (error) &#x3D;&gt; {
          this.manageError(error);
          this.stopLoading();
        },
        complete: () &#x3D;&gt; {
          this.stopLoading();
        }
      });
  }
  /**
     * Load sensor data from the API.
     * Update the state with the new data, manage any errors,
     * and stop the loading spinner when complete.
     */
  public loadDataSensors() {
    this.startLoading();
    this.api.getAllSensors$()
      .subscribe({
        next: (sensors) &#x3D;&gt; {
          this.$store.next({
            ...this.$store.value,
            sensors,
            firstLoad: false
          });
        },
        error: (error) &#x3D;&gt; {
          this.manageError(error);
          this.stopLoading();
        },
        complete: () &#x3D;&gt; {
          this.stopLoading();
        }
      });
  }
  /**
     * Load area data from the API.
     * Update the state with the new data, manage any errors,
     * and stop the loading spinner when complete.
     */
  public loadDataAreas() {
    this.startLoading();
    this.api.getAllAreas$()
      .subscribe({
        next: (areas) &#x3D;&gt; {
          this.$store.next({
            ...this.$store.value,
            areas,
            firstLoad: false
          });
        },
        error: (error) &#x3D;&gt; {
          this.manageError(error);
          this.stopLoading();
        },
        complete: () &#x3D;&gt; {
          this.stopLoading();
        }
      });
  }


  /**
     * Start the loading spinner.
     */
  private startLoading() {
    this.$store.next({
      ...this.$store.value,
      loading: true
    });
  }
  /**
     * Stop the loading spinner.
     */
  private stopLoading() {
    this.$store.next({
      ...this.$store.value,
      loading: false
    });
  }
  /**
     * Update a lamp&#x27;s pending status.
     * This is used to show that a lamp&#x27;s status is being changed.
     */
  private setLampPending(lamp: LampStatus, pending: boolean) {
    this.$store.next({
      ...this.$store.value,
      lamps: this.$store.value.lamps.map(l &#x3D;&gt; l.id &#x3D;&#x3D;&#x3D; lamp.id ? { ...l, pending } : l)
    });
  }
  /**
     * Toggle a lamp&#x27;s status.
     * Call the API to update the lamp&#x27;s status,
     * then reload the lamp data to reflect the changes.
     */
  public toggleLamp(lamp: LampStatus) {
    this.setLampPending(lamp, true);
    this.api.toggleLamp$(lamp.id, lamp.status &#x3D;&#x3D;&#x3D; &quot;On&quot; ? &quot;Off&quot; : &quot;On&quot;)
      .subscribe({
        next: () &#x3D;&gt; this.loadData()
      });
  }
  /**
     * Toggle a sensor&#x27;s status.
     * Call the API to update the sensor&#x27;s status,
     * then reload the sensor data to reflect the changes.
     */
  public toggleSensor(sensor: SensorStatus) {
    this.setLampPending(sensor, true);
    this.api.toggleLamp$(sensor.id, sensor.status &#x3D;&#x3D;&#x3D; &quot;On&quot; ? &quot;Off&quot; : &quot;On&quot;)
      .subscribe({
        next: () &#x3D;&gt; this.loadData()
      });
  }

  /**
     * Manage errors.
     * Update the state with an appropriate error message based on the HTTP status code.
     */

  private manageError(error: any) {
    if (error.status &#x3D;&#x3D;&#x3D; HttpStatusCode.NotFound) {
      this.$store.next({
        ...this.$store.value,
        error: &quot;Not found&quot;
      });
    } else {
      this.$store.next({
        ...this.$store.value,
        error: &quot;Error&quot;
      });
    }
  }
  /**
  * Add a new lamp with the provided alias.
  * Start the loading spinner, call the API to add the lamp,
  * then stop the loading spinner and reload the lamp data.
  * @param alias The alias of the new lamp.
  * @returns An observable that emits a boolean value indicating whether the lamp addition was successful.
  */
  public addLamp$(alias: string): Observable&lt;boolean&gt; {
    return of(true)
      .pipe(
        tap(() &#x3D;&gt; this.startLoading()),
        switchMap(() &#x3D;&gt; this.api.addLamp$(alias)),
        map(() &#x3D;&gt; true),
        catchError(() &#x3D;&gt; of(false)),
        tap(() &#x3D;&gt; this.loadData())
      );
  }
  /**
   * Add a new sensor with the provided alias, geo position, and action range.
   * Start the loading spinner, call the API to add the sensor,
   * then stop the loading spinner and reload the sensor data.
   * @param alias The alias of the new sensor.
   * @param geoPos The geographic position of the new sensor.
   * @param actionRange The action range of the new sensor.
   * @returns An observable that emits a boolean value indicating whether the sensor addition was successful.
   */

  public addSensor$(alias: string, geoPos: string, actionRange: string): Observable&lt;boolean&gt; {
    return of(true)
      .pipe(
        tap(() &#x3D;&gt; this.startLoading()),
        switchMap(() &#x3D;&gt; this.api.addSensor$(alias, geoPos, actionRange)),
        map(() &#x3D;&gt; true),
        catchError(() &#x3D;&gt; of(false)),
        tap(() &#x3D;&gt; this.loadData())
      );
  }
  /**
 * Add a new area with the provided alias.
 * Start the loading spinner, call the API to add the area,
 * then stop the loading spinner and reload the area data.
 * @param alias The alias of the new area.
 * @returns An observable that emits a boolean value indicating whether the area addition was successful.
 */
  public addArea$(alias: string): Observable&lt;boolean&gt; {
    return of(true)
      .pipe(
        tap(() &#x3D;&gt; {
          this.startLoading()
        }),
        switchMap(() &#x3D;&gt; this.api.addArea$(alias)),
        map(() &#x3D;&gt; true),
        catchError(() &#x3D;&gt; of(false)),
        tap(() &#x3D;&gt; this.loadDataAreas())
      );
  }

}

</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Store.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
